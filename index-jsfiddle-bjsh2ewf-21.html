<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Geowhirl - Ultimate Real-Time GPS Tracker</title>

  <style>
    * {
  box-sizing: border-box;
}

body, html {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: flex;
  flex-direction: column;
}

.info-panel {
  background: #fff;
  padding: 1rem 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  z-index: 1000;
  text-align: center;
}

h1 {
  margin: 0 0 0.5rem 0;
}

p {
  margin: 0.25rem 0;
  font-size: 1rem;
}

.buttons {
  margin-top: 1rem;
}

button {
  background-color: #0077ff;
  border: none;
  color: white;
  padding: 0.5rem 1.2rem;
  margin: 0 0.4rem;
  border-radius: 5px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #005ecb;
}

#errorMsg {
  color: #d32f2f;
  margin-top: 0.5rem;
  font-weight: bold;
}

#map {
  flex-grow: 1;
  width: 100%;
  height: calc(100vh - 190px);
}

/* Responsive */
@media (max-width: 600px) {
  .info-panel {
    font-size: 0.9rem;
    padding: 1rem 1rem;
  }

  button {
    padding: 0.45rem 1rem;
    font-size: 0.9rem;
  }
}

  </style>

  
</head>
<body>
  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <div class="info-panel">
    <h1>Geowhirlüç•</h1>
    <p><strong>Coordinates:</strong> <span id="coords">Waiting for location...</span></p>
    <p><strong>Speed:</strong> <span id="speed">0</span> km/h</p>
    <p><strong>Distance:</strong> <span id="distance">0</span> m</p>
    <div class="buttons">
      <button id="resetBtn">Reset</button>
      <button id="exportBtn">Export Route (JSON)</button>
    </div>
    <p id="errorMsg" class="error"></p>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="script.js"></script>

  <script>
    // Setup map and layers
const map = L.map('map').setView([0, 0], 13);
const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors',
  maxZoom: 19
}).addTo(map);

const marker = L.marker([0, 0]).addTo(map);
const polyline = L.polyline([], { color: 'blue' }).addTo(map);

let path = [];
let totalDistance = 0;
let lastLatLng = null;
let tracking = true;

const coordsEl = document.getElementById('coords');
const speedEl = document.getElementById('speed');
const distanceEl = document.getElementById('distance');
const errorMsg = document.getElementById('errorMsg');
const resetBtn = document.getElementById('resetBtn');
const exportBtn = document.getElementById('exportBtn');

// Convert degrees to radians
function toRad(value) {
  return value * Math.PI / 180;
}

// Calculate distance between two lat/lng points in meters
function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000; // meters
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat / 2) ** 2 +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

// Update UI info
function updateInfo(lat, lng, speed) {
  coordsEl.textContent = `Latitude: ${lat.toFixed(5)}, Longitude: ${lng.toFixed(5)}`;
  speedEl.textContent = `Speed: ${(speed * 3.6 || 0).toFixed(1)} km/h`;
  distanceEl.textContent = `Distance: ${Math.round(totalDistance)} m`;
}

// Add "You are here" popup when marker clicked
marker.on('click', () => {
  marker.bindPopup('You are here').openPopup();
});

// Reset tracking data
function resetTracking() {
  path = [];
  totalDistance = 0;
  lastLatLng = null;
  polyline.setLatLngs([]);
  updateInfo(0, 0, 0);
  errorMsg.textContent = '';
}

// Export route data to JSON file
function exportRoute() {
  if (path.length === 0) {
    alert('No route data to export!');
    return;
  }
  const routeData = path.map(([lat, lng]) => ({ lat, lng, timestamp: new Date().toISOString() }));
  const blob = new Blob([JSON.stringify(routeData, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'localoom_route.json';
  a.click();
  URL.revokeObjectURL(url);
}

resetBtn.addEventListener('click', resetTracking);
exportBtn.addEventListener('click', exportRoute);

// Start watching position
if ('geolocation' in navigator) {
  navigator.geolocation.watchPosition(position => {
    if (!tracking) return;
    const { latitude, longitude, speed } = position.coords;
    const latlng = [latitude, longitude];

    if (lastLatLng) {
      const dist = calcDistance(lastLatLng[0], lastLatLng[1], latitude, longitude);
      totalDistance += dist;
    }

    lastLatLng = latlng;
    path.push(latlng);
    polyline.setLatLngs(path);
    marker.setLatLng(latlng);
    map.setView(latlng, map.getZoom());
    updateInfo(latitude, longitude, speed);
    errorMsg.textContent = '';
  }, err => {
    errorMsg.textContent = `Unable to get location: ${err.message}`;
  }, {
    enableHighAccuracy: true,
    maximumAge: 0,
    timeout: 10000
  });
} else {
  errorMsg.textContent = 'Geolocation is not supported by your browser.';
}

  </script>
</body>
</html>
